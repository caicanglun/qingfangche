(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/qing-f-c/printer/printer"],{"49a3":function(e,t,r){"use strict";var i,n=function(){var e=this,t=e.$createElement;e._self._c},c=[];r.d(t,"b",function(){return n}),r.d(t,"c",function(){return c}),r.d(t,"a",function(){return i})},"7ca8":function(e,t,r){"use strict";r.r(t);var i=r("fdbd"),n=r.n(i);for(var c in i)"default"!==c&&function(e){r.d(t,e,function(){return i[e]})}(c);t["default"]=n.a},c318:function(e,t,r){"use strict";(function(e){r("3b9b"),r("921b");i(r("66fd"));var t=i(r("e7e2"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("6e42")["createPage"])},e7e2:function(e,t,r){"use strict";r.r(t);var i=r("49a3"),n=r("7ca8");for(var c in n)"default"!==c&&function(e){r.d(t,e,function(){return n[e]})}(c);var a,s=r("f0c5"),o=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);t["default"]=o.exports},fdbd:function(e,t,r){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,c=r("f30c"),a=r("48a9"),s={data:function(){return{devices:[],currDev:null,connId:"",piaojuText:"",number:"",orderType:"",topList:"",url:"",showData:""}},computed:{},onLoad:function(e){n=this,this.number=e.number,this.orderType=e.orderType,this.getInquiryInfo()},onUnload:function(){n.destroyed()},methods:{getInquiryInfo:function(){var t=this.Api.qrCode,r={number:n.number,orderType:n.orderType};this.myRequest(r,t,"get").then(function(t){e("log",t," at pages/qing-f-c/printer/printer.vue:72"),n.topList=t.data.data,n.number=t.data.data.number,n.showData=t.data.data.showData}).catch(function(e){wx.showToast({title:e.data.errMsg,icon:"none"})})},destroyed:function(){e("log","destroyed----------"," at pages/qing-f-c/printer/printer.vue:86"),""!=this.connId&&i.closeBLEConnection({deviceId:this.connId,success:function(t){e("log",t," at pages/qing-f-c/printer/printer.vue:91")}})},searchBle:function(){var t=this;e("log","initBule"," at pages/qing-f-c/printer/printer.vue:99"),i.openBluetoothAdapter({success:function(r){e("log","打开 蓝牙模块"," at pages/qing-f-c/printer/printer.vue:102"),e("log",r," at pages/qing-f-c/printer/printer.vue:103"),t.onDevice(),i.getBluetoothAdapterState({success:function(r){e("log",r," at pages/qing-f-c/printer/printer.vue:107"),r.available?(r.discovering&&t.stopFindBule(),e("log","开始搜寻附近的蓝牙外围设备"," at pages/qing-f-c/printer/printer.vue:114"),i.startBluetoothDevicesDiscovery({success:function(t){e("log",t," at pages/qing-f-c/printer/printer.vue:117")}})):(e("log","本机蓝牙不可用"," at pages/qing-f-c/printer/printer.vue:122"),i.showToast({title:"本机蓝牙不可用",icon:"none",duration:2e3}))}})}})},onDevice:function(){e("log","监听寻找到新设备的事件---------------"," at pages/qing-f-c/printer/printer.vue:135");var t=this;t.devices=[],i.onBluetoothDeviceFound(function(r){e("log","--------------new-----------------------"+JSON.stringify(r)," at pages/qing-f-c/printer/printer.vue:140");var i=JSON.parse(JSON.stringify(r));e("log",i.devices[0].name+"  "+i.devices[0].deviceId," at pages/qing-f-c/printer/printer.vue:142");var n=i.devices[0].name;if("未知设备"!=n){var c=i.devices[0].deviceId;t.devices.push({name:n,deviceId:c,services:[]})}})},stopFindBule:function(){e("log","停止搜寻附近的蓝牙外围设备---------------"," at pages/qing-f-c/printer/printer.vue:160"),i.stopBluetoothDevicesDiscovery({success:function(t){e("log",t," at pages/qing-f-c/printer/printer.vue:163")}})},onConn:function(t){var r=this;e("log","连接蓝牙---------------"+t.deviceId," at pages/qing-f-c/printer/printer.vue:169");var n=t.deviceId;i.createBLEConnection({deviceId:n,complete:function(c){"createBLEConnection:ok"==c.errMsg?(e("log","连接蓝牙-["+t.name+"]--成功"," at pages/qing-f-c/printer/printer.vue:175"),i.showToast({title:"连接成功",duration:3e3}),r.connId=n,r.currDev=t,setTimeout(function(){r.getBLEServices(n)},2e3)):e("log",c," at pages/qing-f-c/printer/printer.vue:186"),r.stopFindBule()}})},getBLEServices:function(t){var r=this,n=t;e("log","获取蓝牙设备所有服务(service)。---------------"," at pages/qing-f-c/printer/printer.vue:198"),i.getBLEDeviceServices({deviceId:n,complete:function(t){e("log",t," at pages/qing-f-c/printer/printer.vue:204");for(var c=function(){e("log",t.services[a].uuid," at pages/qing-f-c/printer/printer.vue:207");var c=t.services[a].uuid;i.getBLEDeviceCharacteristics({deviceId:n,serviceId:c,success:function(t){var i=JSON.parse(JSON.stringify(t));e("log","deviceId = ["+n+"]  serviceId = ["+c+"]"," at pages/qing-f-c/printer/printer.vue:217");for(var a=0;a<i.characteristics.length;a++)if(1==i.characteristics[a].properties.write){var s=i.characteristics[a].uuid;for(var o in e("log"," deviceId = ["+n+"]  serviceId = ["+c+"] characteristics=["+s," at pages/qing-f-c/printer/printer.vue:221"),r.devices)if(r.devices[o].deviceId==n){r.devices[o].services.push({serviceId:c,characteristicId:s});break}e("log",JSON.stringify(r.devices)," at pages/qing-f-c/printer/printer.vue:234")}}})},a=0;a<t.services.length;a++)c()},fail:function(t){e("log",t," at pages/qing-f-c/printer/printer.vue:247")}})},senBlData:function(t,r,n,c){e("log","************deviceId = ["+t+"]  serviceId = ["+r+"] characteristics=["+n+"]"," at pages/qing-f-c/printer/printer.vue:253");var a=Array.from(c);function s(t,r){for(var i={},n=0,c=0;c<t.length;c+=r)i[n]=t.slice(c,c+r),n++;return e("log",i," at pages/qing-f-c/printer/printer.vue:262"),i}var o=s(a,20);function u(c,a){var s=c[a];if("undefined"!=typeof s){e("log","第【"+a+"】次写数据"+s," at pages/qing-f-c/printer/printer.vue:272");for(var o=new ArrayBuffer(s.length),v=new DataView(o),d=0;d<s.length;d++)v.setUint8(d,s[d]);i.writeBLECharacteristicValue({deviceId:t,serviceId:r,characteristicId:n,value:o,success:function(e){u(c,a+1)}})}}var v=0;u(o,v)},senBleLabel:function(){var e=n.topList.orderType+"#轻纺车网络科技欢迎你#"+n.topList.number;i.showToast({title:e,duration:1e3});var t=30,r=this.currDev.deviceId,a=this.currDev.services[0].serviceId,s=this.currDev.services[0].characteristicId,o=c.jpPrinter.createNew();o.setSize(74,52),o.setGap(2),o.setCls();for(var u=0;u<n.showData.length;u++)o.setText(250,t,"TSS24.BF2",1,1,n.showData[u]),t+=35;o.setText(20,30,"TSS24.BF2",2,2,"轻纺车网"),o.setText(60,100,"TSS24.BF2",1,1,"144F.com"),o.setQR(20,140,"L",8,"A",e),o.setPagePrint(),this.senBlData(r,a,s,o.getData())},senBleLabel2:function(){var e=this.currDev.deviceId,t=this.currDev.services[0].serviceId,r=this.currDev.services[0].characteristicId,i=a.jpPrinter.createNew();i.init(),i.setText(this.piaojuText),i.setPrintAndFeedRow(1),this.senBlData(e,t,r,i.getData())}}};t.default=s}).call(this,r("0de9")["default"],r("6e42")["default"])}},[["c318","common/runtime","common/vendor"]]]);